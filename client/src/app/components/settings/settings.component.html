<section class="settingsForm">
  <div class="settings">
    <mat-form-field appearance="fill">
      <mat-label>Currency</mat-label>
      <mat-select [compareWith]="compareWith" [(ngModel)]="currentSettings.currency">
        <mat-option>
          <ngx-mat-select-search [(ngModel)]="searchCurrency"
          placeholderLabel="Search country..." 
          noEntriesFoundLabel="'No Currency found'">
          </ngx-mat-select-search>
        </mat-option>
        <mat-option *ngFor="let currency of currencyList | filter:'name':searchCurrency" [value]="currency">
          {{currency.name}}({{currency.symbol}})
        </mat-option>
      </mat-select>
    </mat-form-field>

    <button type="submit" mat-raised-button color="accent" (click)="updateSettings()">Save</button>

    <!--Mode of Payment-->
    <section class="pd-t10">
      <label class="text-16 pd-tr10"><strong>Modes of Payment</strong></label>
      <button mat-icon-button (click)="openPaymentModal(addPaymentModeModal)" [matTooltip]="'Add Mode of Payment'" [attr.aria-label]="'addPayment'">
        <img src="/assets/images/plus.png" alt="Add Mode of Payment" width="30px" />
      </button>
    </section>
    <section class="flexStart box-shadow">
      <mat-list role="list" class="payment-list">
        <mat-list-item role="listitem" *ngFor="let mode of paymentModesList">
          <div>
            <img src={{mode.icon}} width="25px" alt="payment-icon" /> {{mode.name}}
          </div>
          <div class="pd-l40 flex" *ngIf="mode.user">
            <button mat-icon-button color="primary" class="mg-t5" [matTooltip]="'Edit'" (click)="openPaymentModal(addPaymentModeModal, mode)" [attr.aria-label]="'edit'">
              <i class="fa fa-edit fa-2x"></i>
            </button>
            <button mat-icon-button color="warn" [matTooltip]="'Delete'" (click)="onDeletePaymentMode(mode)" [attr.aria-label]="'delete'">
              <i class="fa fa-trash fa-2x"></i>
            </button>
          </div>
        </mat-list-item>
      </mat-list>
    </section>
    
    <!--Category-->
    <section class="pd-t10">
      <label class="text-16 pd-tr10"><strong>Categories</strong></label>
      <button mat-icon-button (click)="openCategoryModal(addCategoryModal)" [matTooltip]="'Add category'" [attr.aria-label]="'addCategory'">
        <img src="/assets/images/plus.png" alt="Add Category" width="30px" />
      </button>
    </section>
    <section class="flexStart box-shadow">
      <mat-list role="list" class="categories-list">
        <mat-list-item role="listitem" *ngFor="let category of categoryList">
          <div>
            <img src={{category.icon}} width="25px" alt="category-icon" /> {{category.name}}
          </div>
          <div class="pd-l40 flex" *ngIf="category.user">
            <button mat-icon-button color="primary" class="mg-t5" [matTooltip]="'Edit'" (click)="openCategoryModal(addCategoryModal, category)" [attr.aria-label]="'edit'">
              <i class="fa fa-edit fa-2x"></i>
            </button>
            <button mat-icon-button color="warn" [matTooltip]="'Delete'" (click)="deleteCategory(category)" [attr.aria-label]="'delete'">
              <i class="fa fa-trash fa-2x"></i>
            </button>
          </div>
        </mat-list-item>
      </mat-list>
    </section>
  </div>

  <div class="backup-restore">
    <h2>Backup and Restore</h2>
    <p>Backup your data by downloading a spreadsheet</p>
    <button type="button" mat-raised-button color="primary" (click)="downloadSpreadsheet()">Download
      Spreadsheet</button>
    <br>
    <p>Insert data into your account by uploading a spreadsheet</p>
    <div class="flexStart">
      <button type="button" mat-raised-button color="primary" (click)="openCategoryModal(confirmUploadModal)">Upload Spreadsheet</button>
    </div>
    <input class="hidden" type="file" accept=".xlsx" #filePicker (change)="uploadSpreadsheet($event)">
  </div>

  <div class="danger-section">
    <h2>Danger Section</h2>
    <button type="button" mat-raised-button color="warn" (click)="deleteTransactions()">Delete all transactions</button>
  </div>
</section>

<ng-template #confirmUploadModal>
  <div class="modal-header">
    <h2 class="modal-title">Upload Spreadsheet</h2>
    <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="confirmUploadmodalRef.hide()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    Before uploading your spreadsheet, please make sure of the following,
    <div class="upload_instructions">
      <ol>
        <li>
          Columns of your sheet should be <br>
          A: Date (date of your transaction) <br>
          B: Category (find all the categories in the settings) <br>
          C: Amount (without currency) <br>
          D: Note
        </li>
        <li>
          Categories of your transactions should match with the listed categories in the settings
        </li>
      </ol>
    </div>
    <strong>Proceed with uploading your spreadsheet?</strong>
  </div>
  <div class="modal-footer">
    <button type="button" mat-button (click)="closeModal()">No</button>
    <button type="submit" mat-raised-button color="accent" (click)="browseFile()">Yes</button>
  </div>
</ng-template>

<ng-template #addCategoryModal>
  <div class="modal-header">
    <h2 class="modal-title">{{editCategory ? 'Modify' : 'Add'}} a category</h2>
    <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="closeModal()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form class="add-category-form" [formGroup]="addCategoryForm">
      <mat-form-field appearance="outline">
        <mat-label>Name</mat-label>
        <input matInput formControlName="name" [maxlength]="30" required>
      </mat-form-field>

      <label class="text-14"><strong>Transaction type</strong></label>
      <mat-radio-group aria-label="Type" formControlName="type" required>
        <mat-radio-button class="pd-r10" value="expense">Expense</mat-radio-button>
        <mat-radio-button value="income">Income</mat-radio-button>
      </mat-radio-group>

      <label class="text-14 pd-t10"><strong>Choose an icon</strong></label>
      <mat-button-toggle-group name="iconPath" aria-label="icon" formControlName="icon">
        <mat-button-toggle [value]="icon" *ngFor="let icon of categoryIconPaths">
          <img class="icon" aria-hidden [src]="icon" alt="category-icon">
        </mat-button-toggle>
      </mat-button-toggle-group>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" mat-button (click)="closeModal()">Cancel</button>
    <button type="submit" mat-raised-button color="accent" (click)="addCategory()">{{editCategory ? 'Modify' : 'Add'}}</button>
  </div>
</ng-template>

<ng-template #addPaymentModeModal>
  <div class="modal-header">
    <h2 class="modal-title">{{editPaymentMode ? 'Modify' : 'Add'}} a Payment Mode</h2>
    <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="closeModal()">
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form class="add-category-form" [formGroup]="addPaymentModeForm">
      <mat-form-field appearance="outline">
        <mat-label>Name</mat-label>
        <input matInput formControlName="name" [maxlength]="50" required>
      </mat-form-field>

      <label class="text-14 pd-t10"><strong>Choose an icon</strong></label>
      <mat-button-toggle-group name="iconPath" aria-label="icon" formControlName="icon">
        <mat-button-toggle [value]="icon" *ngFor="let icon of paymentIconPaths">
          <img class="icon" aria-hidden [src]="icon" alt="payment-icon">
        </mat-button-toggle>
      </mat-button-toggle-group>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" mat-button (click)="closeModal()">Cancel</button>
    <button type="submit" mat-raised-button color="accent" (click)="addPaymentMode()">{{editPaymentMode ? 'Modify' : 'Add'}}</button>
  </div>
</ng-template>