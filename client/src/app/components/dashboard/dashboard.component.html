<div class="overview">
  <!-- Shared template for no data message - available to all sections -->
  <ng-template #noDataTemplate>
    <span class="dataNotAvailable">Data is not available for this metric.</span>
  </ng-template>

  <!--Welcome-->
  <section class="welcome centered" *ngIf="isLoading">
    <h1 class="heading-1">Welcome! <strong>{{ currentUser.firstName ? currentUser.firstName : currentUser.email }}</strong></h1>
    <p class="body-large">Manage all your finances in simplest way</p>
    <br>
    <a class="link" [routerLink]="'/gettingstarted'">
      Get Started
      <div class="link-icon">
        <svg class="icon" width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd">
          <path d="M21.883 12l-7.527 6.235.644.765 9-7.521-9-7.479-.645.764 7.529 6.236h-21.884v1h21.883z" />
        </svg>
        <svg class="icon" width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd">
          <path d="M21.883 12l-7.527 6.235.644.765 9-7.521-9-7.479-.645.764 7.529 6.236h-21.884v1h21.883z" />
        </svg>
      </div>
    </a>
  </section>

  <!--Topbar: Greeting + Filter Button-->
  <section class="topbar" *ngIf="!isLoading">
    <!-- Active Filters Display -->
    <div class="active-filters" *ngIf="hasActiveFilters()">
      <div class="filter-chips">
        <mat-chip-set>
          <mat-chip *ngIf="selectedMonth" class="filter-chip" removable (removed)="clearMonthFilter()">
            <i class="fa fa-calendar chip-icon"></i>
            {{months[selectedMonth - 1]?.value}}<span *ngIf="selectedYear"> {{selectedYear}}</span>
            <span matChipRemove>×</span>
          </mat-chip>
          <mat-chip *ngIf="paymentMode" class="filter-chip" removable (removed)="clearPaymentModeFilter()">
            <i class="fa fa-credit-card chip-icon"></i>
            {{getPaymentModeName(paymentMode)}}
            <span matChipRemove>×</span>
          </mat-chip>
          <mat-chip *ngIf="search" class="filter-chip" removable (removed)="clearSearchFilter()">
            <i class="fa fa-search chip-icon"></i>
            "{{search}}"
            <span matChipRemove>×</span>
          </mat-chip>
        </mat-chip-set>
      </div>
    </div>

    <div class="filter-actions">
      <button mat-raised-button color="primary" (click)="openFilterModal()" [class.has-filters]="hasActiveFilters()">
        <i class="fa fa-filter"></i>
        Filter
      </button>
      <button mat-raised-button color="primary" (click)="openAddTransactionModal()" [matTooltip]="'Add Transaction'">
        <i class="fa fa-plus"></i>
        Add Transaction
      </button>
    </div>
  </section>

  <!--Financial Overview: Semi-Circle Chart-->
  <section class="financial-overview" *ngIf="!isLoading">
    <mat-card class="overview-bar">
      <div class="card-title">
        <i class="fa fa-pie-chart"></i>
        <span class="heading-4">Financial Overview</span>
      </div>
      <app-financial-overview 
        [income]="totalIncomeAmount"
        [expense]="totalExpenseAmount"
        [currency]="currency">
      </app-financial-overview>
    </mat-card>
  </section>

  <section class="summary" [hidden]="isLoading">
    <!--Expense Summary-->
    <div class="charts">
      <!--Expense Distribution by Category (Left)-->
      <div class="flexCol">
        <mat-card class="overview-bar">
          <div class="card-title">
            <i class="fa fa-bar-chart"></i>
            <span class="heading-4">Expense Distribution</span>
          </div>
          <highcharts-chart *ngIf="expenseDistBarOptions?.series?.[0]?.data?.length; else noDataTemplate" [Highcharts]="Highcharts" [options]="expenseDistBarOptions">
          </highcharts-chart>
        </mat-card>
      </div>

      <!--Calendar (Right)-->
      <div class="flexCol">
        <mat-card class="calendar">
          <full-calendar #fullCalendar id="transactionViewCalendar" [options]="calendarOptions"></full-calendar>
        </mat-card>
      </div>
    </div>
  </section>

  <!--Transactions List (Full width bottom)-->
  <section class="recent-transactions" #recentTransactionsSection *ngIf="!isLoading">
    <div class="transaction-list">
      <mat-card class="transactions-card">
        <div class="card-title">
          <i class="fa fa-list"></i>
          <span class="heading-4">Recent Transactions</span>
        </div>
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search transactions</mat-label>
          <input type="text" matInput placeholder="Search by category or note" name="search" [(ngModel)]="search" (ngModelChange)="onSearchChange($event)">
          <i class="fa fa-search" matSuffix></i>
        </mat-form-field>

        <div class="no-transactions-message" *ngIf="!transactions.length">
          <div class="empty-state">
            <p class="body-normal">
              <span *ngIf="paymentMode || selectedMonth || search">No transactions match your current filters:</span>
            </p>
            <div class="filter-details" *ngIf="paymentMode || selectedMonth || search">
              <div class="filter-item" *ngIf="paymentMode">
                <i class="fa fa-credit-card"></i>
                <img src="{{dashboardView?.icon}}" alt="{{dashboardView?.type}}" width="16px"> 
                <span>{{dashboardView?.name}}</span>
              </div>
              <div class="filter-item" *ngIf="selectedMonth">
                <i class="fa fa-calendar"></i>
                <span>{{months[selectedMonth - 1]?.value}}<span *ngIf="selectedYear"> {{selectedYear}}</span></span>
              </div>
              <div class="filter-item" *ngIf="search">
                <i class="fa fa-search"></i>
                <span>"{{search}}"</span>
              </div>
            </div>
          </div>
        </div>

        <mat-card-content class="list-content" *ngIf="transactions.length">
          <app-transaction-list [transactions]="transactions" [currencySymbol]="currency?.symbol"></app-transaction-list>
        </mat-card-content>
      </mat-card>
    </div>
  </section>
</div>