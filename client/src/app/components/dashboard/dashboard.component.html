<div class="overview">
  <!-- Shared template for no data message - available to all sections -->
  <ng-template #noDataTemplate>
    <span class="dataNotAvailable">Data is not available for this metric.</span>
  </ng-template>

  <!--Welcome/Empty State-->
  <section class="welcome centered" *ngIf="showWelcome">
    <h1 class="heading-2">Welcome! <strong>{{ currentUser.firstName ? currentUser.firstName : currentUser.email }}</strong></h1>
    <p class="body-large">Manage all your finances in simplest way</p>
    <div class="welcome-actions">
      <button mat-raised-button color="primary" (click)="openAddTransactionModal()">
        <i class="fa fa-plus"></i>
        Add First Transaction
      </button>
    </div>
  </section>

  <!--Topbar: Greeting + Filter Button-->
  <section class="topbar" [hidden]="showWelcome">
    <!-- Active Filters Display -->
    <div class="active-filters">
      <div class="filter-chips" *ngIf="hasActiveFilters()">
        <mat-chip-set>
          <mat-chip *ngIf="selectedMonth" class="filter-chip" removable (removed)="clearMonthFilter()">
            <i class="fa fa-calendar chip-icon"></i>
            {{months[selectedMonth - 1]?.value}}<span *ngIf="selectedYear"> {{selectedYear}}</span>
            <span matChipRemove>×</span>
          </mat-chip>
          <mat-chip *ngIf="paymentMode" class="filter-chip" removable (removed)="clearPaymentModeFilter()">
            <i class="fa fa-credit-card chip-icon"></i>
            {{getPaymentModeName(paymentMode)}}
            <span matChipRemove>×</span>
          </mat-chip>
          <mat-chip *ngIf="search" class="filter-chip" removable (removed)="clearSearchFilter()">
            <i class="fa fa-search chip-icon"></i>
            "{{search}}"
            <span matChipRemove>×</span>
          </mat-chip>
        </mat-chip-set>
      </div>
    </div>

    <div class="filter-actions">
      <button mat-raised-button color="primary" (click)="openFilterModal()" [class.has-filters]="hasActiveFilters()">
        <i class="fa fa-filter"></i>
        Filter
      </button>
      <button mat-raised-button color="primary" (click)="openAddTransactionModal()" [matTooltip]="'Add Transaction'">
        <i class="fa fa-plus"></i>
        Add Transaction
      </button>
    </div>
  </section>

  <!-- Dashboard Grid -->
  <section class="dashboard-grid" [hidden]="showWelcome">
    <!--Financial Overview: Semi-Circle Chart-->
    <mat-card class="financial-overview-card">
      <div class="card-title">
        <i class="fa fa-pie-chart"></i>
        <span class="heading-4">Financial Overview</span>
      </div>
      <div *ngIf="!showFinancialOverviewData && !hasActiveFilters()" class="empty-state-message">
        <i class="fa fa-pie-chart empty-icon"></i>
        <p class="body-normal">No financial data available</p>
        <p class="body-small">Add income or expense transactions to see your overview</p>
      </div>
      <app-financial-overview 
        *ngIf="showFinancialOverviewData; else noDataTemplate" 
        [income]="totalIncomeAmount" 
        [expense]="totalExpenseAmount" 
        [currency]="currency">
      </app-financial-overview>
    </mat-card>

    <!--Expense Distribution by Category-->
    <mat-card class="expense-distribution-card">
      <div class="card-title">
        <i class="fa fa-bar-chart"></i>
        <span class="heading-4">Expense Distribution</span>
      </div>
      <div *ngIf="!hasTransactionData && !hasActiveFilters()" class="empty-state-message">
        <i class="fa fa-chart-bar empty-icon"></i>
        <p class="body-normal">No expense data available</p>
        <p class="body-small">Add your first transaction to see expense distribution</p>
      </div>
      <highcharts-chart *ngIf="expenseDistBarOptions?.series?.[0]?.data?.length; else noDataTemplate" [Highcharts]="Highcharts" [options]="expenseDistBarOptions">
      </highcharts-chart>
    </mat-card>

    <!--Calendar-->
    <mat-card class="calendar-card">
      <full-calendar #fullCalendar id="transactionViewCalendar" [options]="calendarOptions"></full-calendar>
    </mat-card>

    <!--Transactions List -->
    <mat-card class="transactions-card">
      <div class="card-title">
        <i class="fa fa-list"></i>
        <span class="heading-4">Recent Transactions</span>
      </div>
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search transactions</mat-label>
        <input type="text" matInput placeholder="Search by category or note" name="search" [(ngModel)]="search" (ngModelChange)="onSearchChange($event)">
        <i class="fa fa-search" matSuffix></i>
      </mat-form-field>

      <div class="no-transactions-message" *ngIf="!transactions.length">
        <div class="empty-state">
          <p class="body-normal">
            <span *ngIf="paymentMode || selectedMonth || search">No transactions match your current filters:</span>
          </p>
          <div *ngIf="paymentMode || selectedMonth || search">
            <div class="filter-item" *ngIf="paymentMode">
              <i class="fa fa-credit-card"></i>
              <img src="{{dashboardView?.icon}}" alt="{{dashboardView?.type}}" width="16px">
              <span>{{dashboardView?.name}}</span>
            </div>
            <div class="filter-item" *ngIf="selectedMonth">
              <i class="fa fa-calendar"></i>
              <span>{{months[selectedMonth - 1]?.value}}<span *ngIf="selectedYear"> {{selectedYear}}</span></span>
            </div>
            <div class="filter-item" *ngIf="search">
              <i class="fa fa-search"></i>
              <span>"{{search}}"</span>
            </div>
          </div>
        </div>
      </div>

      <mat-card-content class="list-content" *ngIf="transactions.length">
        <app-transaction-list [transactions]="transactions" [currencySymbol]="currency?.symbol"></app-transaction-list>
      </mat-card-content>
    </mat-card>
  </section>
</div>